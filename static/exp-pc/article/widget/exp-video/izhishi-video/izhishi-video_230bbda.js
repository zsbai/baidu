define("article:widget/exp-video/izhishi-video/izhishi-video.js",function(i,o){function e(){if(!z&&p){var i=m.dom.q("video-originate-container")[0];if(w(window).scrollTop()>w(".wgt-douwan-video-box").offset().top+280){w(".wgt-douwan-video-box").addClass("miniVideo");var o=m.dom.q("content-container")[0],e=parseInt(m.dom.getCurrentStyle(o,"width"),10),n=(Math.max(m.page.getViewHeight(),434),m.page.getViewWidth()),a=Math.max((n-e)/2,60)-60;m.dom.fixable(i,{vertival:"bottom",horizontal:"right",offset:{x:a+60,y:10},autofix:!0}),i.style.display="block"}else i.style.position="static",w(".wgt-douwan-video-box").removeClass("miniVideo")}}function n(i,o,n){r=i,k({action:"show",isFirstShow:!0,page:"index"});var g=window.navigator.userAgent.toLowerCase();(g.match(/msie\s\d+/)&&g.match(/msie\s\d+/)[0]||g.match(/trident\s?\d+/)&&g.match(/trident\s?\d+/)[0])&&(window.ieVersion=g.match(/msie\s\d+/)[0].match(/\d+/)[0]||g.match(/trident\s?\d+/)[0],window.ieVersion<8&&(w(".douwan-video-name").html("哎呀，当前浏览器无法播放该视频，请升级到最新版本的浏览器。"),w(".douwan-video-dur").html('<a href="/article/fdbd4277c385f2b89e3f488c.html" target="_blank">如何升级？</a>'),w(".douwan-video-play").remove(),w(".douwan-video-pic").removeClass("douwan-video-pic").addClass("no-support-image")));var y=.8*i.duration,h=w(".wgt-douwan-video-rec"),m=!1;if(h.length){"G2"===o&&(v=window.cyberplayer("douwan-video-2").setup({flashplayer:T.cyberplayer,width:100,height:70,backcolor:"#FFFFFF",stretching:"uniform",file:r.playUrl,autoStart:!0,repeat:!1,volume:0,controls:"none",ak:"b9855350588c4b63b127cebd1d1d252b"}),v.onPause(function(o){w(".douwan-video-2 .play2").addClass("pause"),w("#douwan-video-2").hide();var e=Math.floor(o.position/i.duration*100);e>=P&&(P=e,l(e,i.encVid,n,i.videoType))}),v.onPlay(function(){m||(b.send(location.href,2019,{module:"article",page:"index",pos:"video-exp-izhishi",action:"vv",intention:"autoPlay-log",videoplay:"G2"===o?1:0,videoGroup:o,videoType:i.videoType}),t(i,o,n),m=!0),w(".douwan-video-2 .play2").removeClass("pause").hide()}),v.onComplete(function(){w(".douwan-video-2 .play2").addClass("pause"),w("#douwan-video-2").hide(),L&&V({action:"over"}),L=!1,S=!1,G[4]||(G[0]=G[1]=G[2]=G[3]=G[4]=!0,P=100,l(100,i.encVid,n,i.videoType),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"ended",videoType:i.videoType,videoGroup:o,encVid:i.encVid,eidEnc:n}))}),v.onTime(function(e){var a=Math.floor(e.position/i.duration*100);a>P&&(P=a),s(a,G,i.encVid,n,i.videoType),e.position>=y?(!L&&S&&(V({action:"done"}),L=!0),S=!1):(L=!1,S||(c(i,o,n),S=!0))}),S||(c(i,o,n),S=!0)),p=window.cyberplayer("video-originate-box").setup({flashplayer:T.cyberplayer,width:500,height:280,backcolor:"#FFFFFF",stretching:"uniform",file:r.playUrl,autoStart:!1,repeat:!1,volume:100,controls:"over",controlbar:{barLogo:!1},ak:"b9855350588c4b63b127cebd1d1d252b"}),p&&(h.hasClass("complete")&&p.play(),h.removeClass("complete").addClass("playing"),w(".video-originate-pic",h).hide(),p.on("ready",function(){w(".jw-text-duration",h).text("00:00")}).on("pause",function(o){var e=p.getPosition()-u;h.removeClass("playing").addClass("pause");var a=w(".jw-icon-playback",h);a.removeClass("playing").addClass("paused");var d=Math.floor(o.position/i.duration*100);d>=P&&(P=d,l(d,i.encVid,n,i.videoType)),k({action:"video-stop",stopTime:p.getPosition(),playedTime:e,videoDuration:r.duration}),q=!0}).on("play",function(){m?setTimeout(function(){k({action:"video-play",beginTime:p.getPosition(),videoDuration:r.duration}),u=p.getPosition()},250):(u=p.getPosition(),b.send(location.href,2019,{module:"article",page:"index",pos:"video-exp-izhishi",action:"vv",intention:"autoPlay-log",videoplay:"G2"===o?1:0,videoGroup:o,videoType:i.videoType}),k({action:"click-play",videoDuration:r.duration}),t(i,o,n),m=!0),h.removeClass("pause complete").addClass("playing");var e=w(".jw-icon-playback",h);e.removeClass("paused").addClass("playing"),w(".video-originate-pic",h).hide()}).on("complete",function(){a(),h.removeClass("playing").addClass("complete"),w(".video-originate-pic",h).show(),L&&V({action:"over"}),L=!1,S=!1,D=0,F=[0],E=0,I=!1,G[4]||(G[0]=G[1]=G[2]=G[3]=G[4]=!0,P=100,l(100,i.encVid,n,i.videoType),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"ended",videoType:i.videoType,videoGroup:o,encVid:i.encVid,eidEnc:n}))}).on("time",function(e){var a=Math.floor(e.position/i.duration*100);a>P&&(P=a),s(a,G,i.encVid,n,i.videoType),e.position>=y?(!L&&S&&(V({action:"done"}),L=!0),S=!1):(L=!1,S||(c(i,o,n),S=!0)),d(e)}).on("error",function(){k({action:"play-err"})})),j.on("click",".box-body",function(){w(this).hide(),h.show(),w(".douwan-video-detail-box").removeClass("more"),p.play(),v&&v.pause()&&v.stop(),w("#douwan-video-2").hide(),f.fire("douwan-video/play"),b.send(location.href,2019,{module:"article",page:"index",pos:"douwan-video",action:"click",videoplay:"G1"===o?1:0,videoGroup:o}),S||(c(i,o,n),S=!0)}),w(".douwan-video-2").on("click",function(i){i.stopPropagation(),j.find(".box-body").trigger("click")}).on("click",".play2",function(i){i.stopPropagation(),w(this).hasClass("pause")?j.find(".box-body").trigger("click"):(w("#douwan-video-2").hide(),v.pause(),b.send(location.href,2019,{module:"article",page:"index",pos:"douwan-video-play2",action:"click",videoGroup:o}))});var M=w(".video-originate-pic",h);M.on("click",function(){h.removeClass("complete").addClass("playing"),p&&p.play()}),w(window).on("unload",function(){var o=p&&p.getPosition()||0,e=v&&v.getPosition()||0,a=Math.floor(Math.max(o,e)/i.duration*100);a>=P&&(P=a,l(a,i.encVid,n,i.videoType))})}w("body").on("click",".video-originate-close",function(){p.pause(),p.stop(),w(".wgt-douwan-video-rec").hide(),w(".douwan-video-detail").show(),w(".douwan-video-detail-box").addClass("more")}).on("mouseenter",".wgt-douwan-video-box",function(){(w(".wgt-douwan-video-box").hasClass("playing")||w(".wgt-douwan-video-box").hasClass("pause"))&&w(".wgt-douwan-video-box .video-originate-header").show()}).on("mouseleave",".wgt-douwan-video-box",function(){window.setTimeout(function(){w(".wgt-douwan-video-box .video-originate-header").hide()},2e3)});var _=w(".wgt-douwan-video-originate");if(_.length){var O=w(".video-originate-pic",_);O.on("click",function(){p||(p=window.cyberplayer("video-originate-box").setup({flashplayer:T.cyberplayer,width:500,height:280,backcolor:"#FFFFFF",stretching:"uniform",file:r.playUrl,autoStart:!0,repeat:!1,volume:100,controls:"over",controlbar:{barLogo:!1},ak:"b9855350588c4b63b127cebd1d1d252b"}),m||(b.send(location.href,2019,{module:"article",page:"index",pos:"video-exp-izhishi",action:"vv",intention:"autoPlay-log",videoplay:"G2"===o?1:0,videoGroup:o,videoType:i.videoType}),k({action:"click-play",videoDuration:r.duration}),t(i,o,n),m=!0),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"play",videoType:i.videoType,videoGroup:o,videoplay:"G2"===o?1:0,encVid:i.encVid,eidEnc:n}),S||(c(i,o,n),S=!0),p.on("ready",function(){w(".jw-text-duration",_).text("00:00")}).on("pause",function(o){var e=p.getPosition()-u;_.removeClass("playing").addClass("pause");var a=w(".jw-icon-playback",_);a.removeClass("playing").addClass("paused");var d=Math.floor(o.position/i.duration*100);d>=P&&(P=d,l(d,i.encVid,n,i.videoType)),k({action:"video-stop",stopTime:p.getPosition(),playedTime:e,videoDuration:r.duration}),q=!0}).on("play",function(){m?setTimeout(function(){k({action:"video-play",beginTime:p.getPosition(),videoDuration:r.duration}),u=p.getPosition()},250):(u=p.getPosition(),b.send(location.href,2019,{module:"article",page:"index",pos:"video-exp-izhishi",action:"vv",intention:"autoPlay-log",videoplay:"G2"===o?1:0,videoGroup:o,videoType:i.videoType}),k({action:"click-play",videoDuration:r.duration}),t(i,o,n),m=!0),_.removeClass("pause complete").addClass("playing");var e=w(".jw-icon-playback",_);e.removeClass("paused").addClass("playing"),O.hide()}).on("complete",function(){a(),_.removeClass("playing").addClass("complete"),w(".video-originate-pic",_).show(),L&&V({action:"over"}),L=!1,S=!1,D=0,F=[0],E=0,I=!1,G[4]||(G[0]=G[1]=G[2]=G[3]=G[4]=!0,P=100,l(100,i.encVid,n,i.videoType),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"ended",videoType:i.videoType,videoGroup:o,encVid:i.encVid,eidEnc:n}))}).on("time",function(e){var a=Math.floor(e.position/i.duration*100);a>P&&(P=a),s(a,G,i.encVid,n,i.videoType),e.position>=y?(!L&&S&&(V({action:"done"}),L=!0),S=!1):(L=!1,S||(c(i,o,n),S=!0)),d(e)}).on("error",function(){k({action:"play-err"})})),_.hasClass("complete")&&p.play(),_.removeClass("complete").addClass("playing"),w(".video-originate-pic",_).hide(),w(window).on("unload",function(){if(p){var o=Math.floor(p.getPosition()/i.duration*100);o>=P&&(P=o,l(o,i.encVid,n,i.videoType))}}),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"click",videoType:i.videoType,videoGroup:o,encVid:i.encVid,eidEnc:n}),S||(k({action:"click-play",videoDuration:r.duration}),c(i,o,n),S=!0)}),"G2"===o&&O.trigger("click")}var A=w(".video-originate-container");w(".video-mini-back",A).on("click",function(i){i.preventDefault(),w("html, body").animate({scrollTop:w(".wgt-douwan-video-box").offset().top-64},500)}),w(".video-mini-pause",A).on("click",function(i){i.preventDefault(),p&&p.pause()}),w(".video-mini-replay",A).on("click",function(i){i.preventDefault(),p&&p.play()}),w(".video-mini-play",A).on("click",function(i){i.preventDefault(),p&&p.play()}),w(".video-originate-mini-close",A).on("click",function(i){i.preventDefault(),z=!0,A.css({position:"static"}),w(".wgt-douwan-video-box").removeClass("miniVideo")}),w(window).on("scroll resize",e),new x({target:w(".video-originate-accuse"),video:i}),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"show",videoType:i.videoType,videoGroup:o,encVid:i.encVid,eidEnc:n}),b.send(location.href,2019,{module:"article",page:"index",pos:"video-exp-izhishi",action:"pv",intention:"autoPlay-log",videoplay:"G2"===o?1:0,videoGroup:o,videoType:i.videoType}),C(location.href,2019,{name:"VIDEO_SHOW",act:"view",videoId:i.encVid,eidEnc:n,videoType:i.videoType}),V({action:"show"})}function a(){var i=p.getPosition()-u;k({action:"play-end",stopTime:p.getPosition(),playedTime:i,videoDuration:r.duration})}function d(i){if(y=i.position,g=Math.abs(y-E),g>M){if(F.push(0),D=y,q)q=!1;else{var o=E-u;k({action:"video-stop",stopTime:E,playedTime:o,videoDuration:r.duration}),k({action:"video-play",beginTime:y,videoDuration:r.duration})}u=y}else{var e=Math.abs(y-D);F[F.length-1]=e}E=y,I||(h=F.reduce(function(i,o){return i+o}),h>3&&(k({action:"valid-play"}),I=!0))}function t(i,o,e){w.ajax({url:"/submit/izhishidatapoint?method=addIzhishiPlayPoint",type:"post",data:{izhishiVid:i.encVid}}),C(location.href,2019,{name:"VIDEO_PLAY",act:"clk",videoId:i.encVid,autoPlay:"G2"===o?1:0,eidEnc:e,videoType:i.videoType})}function c(){V({action:"play"})}function l(i,o,e,n){C(location.href,2019,{name:"VIDEO_PLAY_TIME",act:"other",videoId:o,percentage:i,eidEnc:e,videoType:n})}function s(i,o,e,n,a){i>=25&&50>i?o[0]||(o[0]=!0,l(25,e,n,a)):i>=50&&75>i?o[1]||(o[1]=!0,l(50,e,n,a)):i>=75&&80>i?o[2]||(o[2]=!0,l(75,e,n,a)):i>=80&&(o[3]||(o[3]=!0,l(80,e,n,a),b.send(location.href,2019,{module:"article",page:"index",pos:"izhishi-video",action:"video-tail",videoType:a,encVid:e,eidEnc:n})))}var r,p,v,u,g,y,h,m=i("common:widget/lib/tangram/base/base.js"),w=i("common-jquery:widget/lib/jquery/jquery.js"),f=i("common:widget/lib/fis/event/event.js").eventCenter,b=i("common-jquery:widget/js/logic/log/log.js"),T=(i("common-jquery:widget/js/ui/tip/tip.js"),i("common:widget/ui/dialog/dialog.js"),i("common-jquery:widget/js/util/uri/uri.js")),x=i("article:widget/ui/accuse/accuse.js"),C=i("article:widget/js/logic/nslog-izhishi/nslog-izhishi.js"),V=i("article:widget/js/logic/nslog-exp/nslog-exp.js").videoExpSend,k=i("article:widget/js/logic/nslog-exp/nslog-exp.js").videoLogSend,j=w(".wgt-douwan-video"),P=0,G=[!1,!1,!1,!1,!1],z=!1,D=0,F=[0],E=0,M=1,I=!1,q=!1,S=!1,L=!1;o.init=n});