define("common:widget/dep/editor/prototype/prototype",function(t,e,i){{var n=t("common:widget/js/util/tangram/tangram"),o=t("common:widget/js/ui/dialog/dialog"),r=t("common:widget/js/util/event/event");t("common:widget/js/util/log/log")}i.exports={pageUnload:function(t){{var e=this;this.instance}if(e.config.optionList.modify&&e.hasCon()){var i="请注意：您的编辑内容还没有进行保存!";return t.returnValue=i,i}},filterTag:function(t,e){var i=e||"<p><br /></p>",n=t.toLocaleLowerCase().lastIndexOf(i);return n>0&&t.length==n+i.length?t.substring(0,n):t},hasCon:function(){var t=this.instance;return t.getContentTxt().length>0&&t.getContentTxt()!=t.options.initialContent?!0:/<(?:img|iframe)\s+(?:[^>]+\s+)*src\s*=\s*("|')+[^\1]+\1+\s*\/*>/i.test(t.getContent())},hasImg:function(){var t=this.instance;return/<img[^>]+src\s*=\s*['\"]([^'\"]+)['\"][^>]*>/i.test(t.getContent())},checkEditor:function(){var t=this,e=this.instance,i=this.hasCon(),o=!1;if("function"==n.type(e.getUploadFile)&&"ready"!=e.getUploadFile().status){var r=e.getUploadFile();if("complete"!=r.status||!r.fileInfo||!r.fileInfo.fs_id){var a;return a=/(complete|error)/.test(r.status)?1:0,setTimeout(function(){n(".edui-editor-wordcount",e.container).eq(0).html("<span class='f-red' style='direction: none'>"+t.config.fileErrorNum[a]+"</span> "),n(".edui-editor-bottomContainer",e.container).show()},100),!1}o=!0}return i||o?e.hasWordOverflow()?(setTimeout(function(){n(".edui-editor-bottomContainer",e.container).show()},100),!1):!0:(e.focus(),setTimeout(function(){n(".edui-editor-wordcount",e.container).eq(0).html("<span class='f-red' style='direction: none'>"+t.config.optionList.errorClew[0]+"</span> "),n(".edui-editor-bottomContainer",e.container).show()},100),!1)},uploadFile:function(t){var e=this,i=this.instance;if("function"==n.type(i.getUploadFile)){var o=i.getUploadFile();"function"==n.type(i.uploadAction)&&i.uploadAction("submit"),e.hasCon()||(t=""),"complete"==o.status&&(t+='<file fsid="'+o.fileInfo.fs_id+'" wealth="'+o.fileInfo.wealth+'" />')}return t},formatEnter:function(t){for(var e="",i=t.replace(/<br\s*\/*>/gi,"\n").replace(/ /g,"&nbsp;").replace(/\r\n/g,"\n").split("\n"),o=0;o<i.length;o++)e+=""!=n.string(i[o]).trim()?"<p>"+n.string(i[o]).trim()+"</p>":"<p><br /></p>";return e},formatMapContent:function(t){var e=this.unHtml(t).replace("\r\n","\n").split("\n");return"<p>"+e.join("</p><p>")+"</p>"},unHtml:function(t){return t?t.replace(/[&<\">]/g,function(t){return{"<":"&lt;","&":"&amp",'"':"&quot;",">":"&gt;"}[t]}):""},filterMapClew:function(t,e){if(!t)return"";t=t.replace(/<a[^>]*>([\S\s]*?)<\s*\/\s*a\s*>/gi,function(t,e){return/<img[^>]*>/i.test(e)?e:t});var i=new RegExp("<iframe.+?></iframe>","ig"),n=i.exec(t);if(!n)return t;var o=n[0];this.config.optionList.pic=!0;var r="",a="";(n=o.match(/src="(.+?)"/i))&&(r=n[1]),(n=o.match(/map="(.+?)"/i))&&(a=n[1]),r=r?r.replace(/^.+?html\/map/gi,"http://map.baidu.com/iknow"):"http://map.baidu.com/"+a,1==e&&(r=r.replace("http://map.baidu.com/iknow","http://zhidao.baidu.com/html/map"));var s='<iframe data-type="map" map="'+r+'" frameborder="0" src="'+r+'" class="ikqb-mapshow"></iframe>',c=t.replace(i,s);return c=this.filterTag(c)},filterHighlight:function(t){if(!t)return"";var e=/<pre(.*?)>([\s\S]+?)<\/pre>/g,i=t.match(e);return i?t.replace(e,function(t,e,i){var n=e&&e.match(/class="brush:\s*(.+?);.*?"/);return n&&n[1]?'<pre t="code" l="'+n[1]+'">'+i+"</pre>":i}):t},formatCode:function(t){if(!t)return"";var e=/<pre(.*?)>([\s\S]+?)<\/pre>/g,i=t.match(e);return i?t.replace(e,function(t,e,i){var n=e&&e.match(/t="code" l="\s*(.+?)"/);return n&&n[1]?'<pre class="brush:'+n[1]+';toolbar:false">'+i+"</pre>":i}):t},collapseEditor:function(t){var e=this,i=n(e.container);if(e.config.optionList.modify=!1,n.browser.firefox)var o=e.instance.container,r=n(".addons",i.get(0)),a=n(".edui-editor-iframeholder",o),t=190,s=setInterval(function(){t-=20,a.css("height",t+"px"),20>t&&(clearInterval(s),n(o).css("height","0"),r.hide(),i.css({visibility:"hidden",height:"0"}),e.fire("oncollapse"))},20);else{n.browser.ie&&n.browser.ie<7&&setTimeout(function(){i.find("iframe").first().hide()},100),i.css({overflow:"hidden",visibility:"visible",height:"auto"});var s=setInterval(function(){t-=20,i.css("height",t+"px"),20>t&&(clearInterval(s),i.css({overflow:"hidden",visibility:"hidden",height:"0"}),e.fire("oncollapse"))},20)}},expandEditor:function(t){var e=this,i=n(this.container);if(n.browser.firefox){{var o=e.instance.container;n(".addons",i.get(0)).show()}n(o).css("height","");var t=190,r=0,a=n(".edui-editor-iframeholder",o),s=setInterval(function(){r+=20,a.css("height",r+"px"),r>t&&(clearInterval(s),a.css("height","190px"),e.fire("onexpand"))},20);n(i).css("height","").css("visibility","visible")}else{i.css("display","").css({overflow:"hidden",visibility:"visible",height:"0"});var r=0,s=setInterval(function(){r+=20,i.css("height",r+"px"),r>t&&(clearInterval(s),i.css("height","").css({overflow:"visible"}),n.browser.ie&&n.browser.ie<7&&i.find("iframe").first().show(),e.fire("onexpand"))},20)}},setContent:function(t,e){var i=this;setTimeout(function(){""!=t&&("0"==e&&(t=i.formatEnter(t)),t=i.formatCode(i.filterMapClew(t,!0)),i.instance.setContent(t,!1,!0)),i.instance.focus()},500)},afterInit:function(){function t(t,e){o.alert(e,{title:t,width:350,height:160,autoRender:!0})}var e=this,i=this.instance,a=!1;i.addListener("uploadSuccess",function(e,n){"0"!=n.data.errNo?t("插入图片",'<p class="text-tip">'+n.data.errStr+"</p>"):i.focus()}),i.addListener("networkError",function(){t("插入图片","未知错误")}),i.addListener("imageSizeError",function(){t("插入图片",'<p>图片文件过大！</p><p class="f-red">注：大小不超过5M，支持JPG/PNG/BMP/GIF等格式</p>')}),i.addListener("showmap",function(){if(i.options.isLogin){o.iframe({content:e.config.buttonConfig.insertmap.url+"?editor="+e.guid,title:"插入地图",width:710,height:480,autoDispose:!0})}}),i.addListener("showhighlightcode",function(){if(i.options.isLogin)var t=o.iframe({content:e.config.buttonConfig.highlightcode.url+"?editor="+e.guid,title:"插入代码",width:550,height:440,autoDispose:!0,type:"confirm",onaccept:function(){var e=n(t.getElement("content")).find("iframe")[0].contentWindow,o=e.document.getElementById("code").value,r=e.document.getElementById("language").value;i.execCommand("highlightcode",o,r),t.hide()}})}),r.on("editor-"+e.guid+".setmap",function(t,i){var o=e.instance;if(r.fire("dialog.close"),"object"==!n.type(i))return void(t.returnValue=!1);if(i.url){var a='<p><iframe data-type="map" map="'+i.url+'" frameborder="0" src="'+i.url+'" class="ikqb-mapshow"></iframe></p>';o.execCommand("insertHTML",a)}""!=i.info&&(i.info="<p>"+e.formatMapContent(decodeURIComponent(i.info))+"</p>",o.execCommand("insertHTML",i.info)),o.focus()}),r.on("editor.default",function(){e.config.optionList.modify=!1,a=!0}),i.addListener("focus",function(){n(this.container).parent().addClass("editor-focus"),a||(e.config.optionList.modify=!0),r.fire("editor.focus",e)}),i.addListener("blur",function(){n(this.container).parent().removeClass("editor-focus")}),n.browser.isWebkit?window.addEventListener("beforeunload",function(t){return e.pageUnload(t)}):window.onbeforeunload=function(t){t=t||window.event,e.pageUnload(t)}}}});